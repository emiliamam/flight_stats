{"ast":null,"code":"var _jsxFileName = \"/Users/emiliamamedova/charts/project_corona_tracker/src/components/Chart/Chart.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport { Bar, Pie, Line } from 'react-chartjs-2';\nimport DirectionsCharts from './DirectionCharts/DirectionsCharts';\nimport PunctualityChartWithTable from './PunctualityChart/PunctualityChart';\n\nconst Analytics = () => {\n  const [activeTab, setActiveTab] = useState('top3');\n  const [top3Data, setTop3Data] = useState([]);\n  const [directionData, setDirectionData] = useState([]);\n  const [punctualityData, setPunctualityData] = useState([]);\n  const [displayCount, setDisplayCount] = useState(10);\n  useEffect(() => {\n    fetch('http://localhost:8000/get_top3').then(res => res.json()).then(data => setTop3Data(data)).catch(console.error);\n    fetch('http://localhost:8000/get_all_direction').then(res => res.json()).then(data => setDirectionData(data)).catch(console.error);\n    fetch('http://localhost:8000/get_airline_punctuality').then(res => res.json()).then(data => setPunctualityData(data)).catch(console.error);\n  }, []);\n  console.log(top3Data, 'top3Data');\n  console.log(directionData, 'directionData');\n  console.log(punctualityData, 'punctualityData'); // 1. Топ 3 авиакомпании - Bar chart\n  // Топ 3 авиакомпании\n\n  const top3ChartData = {\n    labels: top3Data.map(a => a.airline_name || a['Авиакомпания']),\n    datasets: [{\n      label: 'Пунктуальность вылета',\n      backgroundColor: 'rgba(75,192,192,0.6)',\n      data: top3Data.map(a => {\n        var _a$rating_departure;\n\n        return (_a$rating_departure = a.rating_departure) !== null && _a$rating_departure !== void 0 ? _a$rating_departure : a['Отправление'];\n      })\n    }, {\n      label: 'Пунктуальность прилёта',\n      backgroundColor: 'rgba(153,102,255,0.6)',\n      data: top3Data.map(a => {\n        var _a$rating_arrival;\n\n        return (_a$rating_arrival = a.rating_arrival) !== null && _a$rating_arrival !== void 0 ? _a$rating_arrival : a['Прибытие'];\n      })\n    }]\n  }; // Направления - ограничим топ-10\n\n  const topDirections = [...directionData].sort((a, b) => b.total_flights - a.total_flights).slice(0, 10);\n  const displayedDirections = directionData.slice(0, displayCount);\n  const directionsLabels = displayedDirections.map(d => `${d.airport1} → ${d.airport2}`);\n  const directionsCounts = displayedDirections.map(d => d.total_flights);\n  const directionsChartData = {\n    labels: directionsLabels,\n    datasets: [{\n      label: 'Количество рейсов',\n      data: directionsCounts,\n      backgroundColor: directionsLabels.map(() => `hsl(${Math.floor(Math.random() * 360)}, 70%, 70%)`)\n    }]\n  };\n  const directionsChartOptions = {\n    responsive: true,\n    plugins: {\n      tooltip: {\n        callbacks: {\n          label: context => {\n            var _item$on_time_percent;\n\n            const idx = context.dataIndex;\n            const item = displayedDirections[idx];\n            return [`Рейсов: ${item.total_flights}`, `Пунктуальность: ${(_item$on_time_percent = item.on_time_percentage) !== null && _item$on_time_percent !== void 0 ? _item$on_time_percent : 'н/д'}%`];\n          }\n        }\n      },\n      legend: {\n        display: false\n      }\n    }\n  }; // Пунктуальность - если даты нет, просто покажем среднюю пунктуальность по авиакомпаниям\n\n  const airlines = [...new Set(punctualityData.map(d => d['Авиакомпания']))];\n  const punctualityChartData = {\n    labels: airlines,\n    datasets: [{\n      label: 'Пунктуальность отправления (%)',\n      data: airlines.map(airline => {\n        const rec = punctualityData.find(d => d['Авиакомпания'] === airline);\n        return rec ? rec['Отправление'] : 0;\n      }),\n      backgroundColor: 'rgba(75,192,192,0.6)'\n    }, {\n      label: 'Пунктуальность прибытия (%)',\n      data: airlines.map(airline => {\n        const rec = punctualityData.find(d => d['Авиакомпания'] === airline);\n        return rec ? rec['Прибытие'] : 0;\n      }),\n      backgroundColor: 'rgba(153,102,255,0.6)'\n    }]\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      maxWidth: 1000,\n      height: 900,\n      margin: '20px auto',\n      fontFamily: 'Arial, sans-serif'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    style: {\n      textAlign: 'center',\n      marginBottom: 20\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 5\n    }\n  }, \"\\u0410\\u043D\\u0430\\u043B\\u0438\\u0442\\u0438\\u043A\\u0430 \\u0430\\u0432\\u0438\\u0430\\u043A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u0439 \\u2014 \\u0432\\u044B\\u0431\\u0435\\u0440\\u0438\\u0442\\u0435 \\u0433\\u0440\\u0430\\u0444\\u0438\\u043A\"), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      justifyContent: 'center',\n      gap: 15,\n      marginBottom: 30\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setActiveTab('top3'),\n    disabled: activeTab === 'top3',\n    style: {\n      padding: '10px 20px',\n      borderRadius: 8,\n      border: 'none',\n      cursor: activeTab === 'top3' ? 'default' : 'pointer',\n      backgroundColor: activeTab === 'top3' ? '#4caf50' : '#e0e0e0',\n      color: activeTab === 'top3' ? 'white' : '#333',\n      fontWeight: 'bold',\n      transition: 'background-color 0.3s'\n    },\n    onMouseEnter: e => {\n      if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#81c784';\n    },\n    onMouseLeave: e => {\n      if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#e0e0e0';\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 7\n    }\n  }, \"\\u0422\\u043E\\u043F 3 \\u0430\\u0432\\u0438\\u0430\\u043A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u0438\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setActiveTab('directions'),\n    disabled: activeTab === 'directions',\n    style: {\n      padding: '10px 20px',\n      borderRadius: 8,\n      border: 'none',\n      cursor: activeTab === 'directions' ? 'default' : 'pointer',\n      backgroundColor: activeTab === 'directions' ? '#4caf50' : '#e0e0e0',\n      color: activeTab === 'directions' ? 'white' : '#333',\n      fontWeight: 'bold',\n      transition: 'background-color 0.3s'\n    },\n    onMouseEnter: e => {\n      if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#81c784';\n    },\n    onMouseLeave: e => {\n      if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#e0e0e0';\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }\n  }, \"\\u041D\\u0430\\u043F\\u0440\\u0430\\u0432\\u043B\\u0435\\u043D\\u0438\\u044F\"), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => setActiveTab('punctuality'),\n    disabled: activeTab === 'punctuality',\n    style: {\n      padding: '10px 20px',\n      borderRadius: 8,\n      border: 'none',\n      cursor: activeTab === 'punctuality' ? 'default' : 'pointer',\n      backgroundColor: activeTab === 'punctuality' ? '#4caf50' : '#e0e0e0',\n      color: activeTab === 'punctuality' ? 'white' : '#333',\n      fontWeight: 'bold',\n      transition: 'background-color 0.3s'\n    },\n    onMouseEnter: e => {\n      if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#81c784';\n    },\n    onMouseLeave: e => {\n      if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#e0e0e0';\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 7\n    }\n  }, \"\\u0410\\u0432\\u0438\\u0430\\u043A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u0438\")), activeTab === 'top3' && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"h3\", {\n    style: {\n      textAlign: 'center',\n      marginBottom: 10\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 9\n    }\n  }, \"\\u0422\\u043E\\u043F 3 \\u0430\\u0432\\u0438\\u0430\\u043A\\u043E\\u043C\\u043F\\u0430\\u043D\\u0438\\u0438 \\u043F\\u043E \\u043F\\u0443\\u043D\\u043A\\u0442\\u0443\\u0430\\u043B\\u044C\\u043D\\u043E\\u0441\\u0442\\u0438\"), /*#__PURE__*/React.createElement(Bar, {\n    data: top3ChartData,\n    options: {\n      responsive: true,\n      plugins: {\n        title: {\n          display: false\n        }\n      }\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 9\n    }\n  })), activeTab === 'directions' && /*#__PURE__*/React.createElement(DirectionsCharts, {\n    directionData: directionData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 34\n    }\n  }) // <>\n  //   <h3 style={{ textAlign: 'center', marginBottom: 5 }}>\n  //     Топ {displayCount} направлений по количеству рейсов\n  //   </h3>\n  //   <p style={{ textAlign: 'center', marginBottom: 15, fontSize: 14, color: '#666' }}>\n  //     Отображаются направления с наибольшим числом рейсов. Наведи на сегмент, чтобы увидеть пунктуальность.\n  //   </p>\n  //   <div style={{ textAlign: 'center', marginBottom: 15 }}>\n  //     <input\n  //       type=\"range\"\n  //       min={1}\n  //       max={Math.min(100, directionData.length)}\n  //       value={displayCount}\n  //       onChange={e => setDisplayCount(Number(e.target.value))}\n  //       style={{ width: 300 }}\n  //     />\n  //     <div>{displayCount} направлений</div>\n  //   </div>\n  //   <div style={{ height: 500 }}>\n  //     <Pie\n  //       data={directionsChartData}\n  //       options={{\n  //         responsive: true,\n  //         maintainAspectRatio: false,\n  //         plugins: {\n  //           tooltip: {\n  //             callbacks: {\n  //               label: (context) => {\n  //                 const label = context.label || '';\n  //                 const percentage = directionData[context.dataIndex]?.on_time_percentage ?? 'н/д';\n  //                 return `${label}: ${context.formattedValue} рейсов — пунктуальность ${percentage}%`;\n  //               }\n  //             }\n  //           }\n  //         }\n  //       }}\n  //     />\n  //   </div>\n  // </>\n  , activeTab === 'punctuality' && /*#__PURE__*/React.createElement(PunctualityChartWithTable, {\n    data: punctualityData,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }\n  }) // <>\n  //   <h3 style={{ textAlign: 'center', marginBottom: 10 }}>Пунктуальность авиакомпаний</h3>\n  //   <Bar\n  //     data={punctualityChartData}\n  //     options={{\n  //       responsive: true,\n  //       plugins: { title: { display: false } },\n  //       scales: {\n  //         y: { min: 0, max: 100, title: { display: true, text: 'Пунктуальность (%)' } },\n  //         x: { title: { display: true, text: 'Авиакомпания' } },\n  //       },\n  //     }}\n  //   />\n  // </>\n  );\n};\n\nexport default Analytics;","map":{"version":3,"sources":["/Users/emiliamamedova/charts/project_corona_tracker/src/components/Chart/Chart.jsx"],"names":["React","useState","useEffect","Bar","Pie","Line","DirectionsCharts","PunctualityChartWithTable","Analytics","activeTab","setActiveTab","top3Data","setTop3Data","directionData","setDirectionData","punctualityData","setPunctualityData","displayCount","setDisplayCount","fetch","then","res","json","data","catch","console","error","log","top3ChartData","labels","map","a","airline_name","datasets","label","backgroundColor","rating_departure","rating_arrival","topDirections","sort","b","total_flights","slice","displayedDirections","directionsLabels","d","airport1","airport2","directionsCounts","directionsChartData","Math","floor","random","directionsChartOptions","responsive","plugins","tooltip","callbacks","context","idx","dataIndex","item","on_time_percentage","legend","display","airlines","Set","punctualityChartData","airline","rec","find","maxWidth","height","margin","fontFamily","textAlign","marginBottom","justifyContent","gap","padding","borderRadius","border","cursor","color","fontWeight","transition","e","currentTarget","disabled","style","title"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Bar, Pie, Line } from 'react-chartjs-2';\nimport DirectionsCharts from './DirectionCharts/DirectionsCharts';\nimport PunctualityChartWithTable from './PunctualityChart/PunctualityChart';\n\nconst Analytics = () => {\n  const [activeTab, setActiveTab] = useState('top3');\n  const [top3Data, setTop3Data] = useState([]);\n  const [directionData, setDirectionData] = useState([]);\n  const [punctualityData, setPunctualityData] = useState([]);\n  const [displayCount, setDisplayCount] = useState(10);\n\n  useEffect(() => {\n    fetch('http://localhost:8000/get_top3')\n      .then(res => res.json())\n      .then(data => setTop3Data(data))\n      .catch(console.error);\n\n    fetch('http://localhost:8000/get_all_direction')\n      .then(res => res.json())\n      .then(data => setDirectionData(data))\n      .catch(console.error);\n\n    fetch('http://localhost:8000/get_airline_punctuality')\n      .then(res => res.json())\n      .then(data => setPunctualityData(data))\n      .catch(console.error);\n  }, []);\n\n  console.log(top3Data, 'top3Data')\n  console.log(directionData, 'directionData')\n  console.log(punctualityData, 'punctualityData')\n\n  // 1. Топ 3 авиакомпании - Bar chart\n  // Топ 3 авиакомпании\nconst top3ChartData = {\n  labels: top3Data.map(a => a.airline_name || a['Авиакомпания']),\n  datasets: [\n    {\n      label: 'Пунктуальность вылета',\n      backgroundColor: 'rgba(75,192,192,0.6)',\n      data: top3Data.map(a => a.rating_departure ?? a['Отправление']),\n    },\n    {\n      label: 'Пунктуальность прилёта',\n      backgroundColor: 'rgba(153,102,255,0.6)',\n      data: top3Data.map(a => a.rating_arrival ?? a['Прибытие']),\n    },\n  ],\n};\n\n// Направления - ограничим топ-10\nconst topDirections = [...directionData]\n  .sort((a, b) => b.total_flights - a.total_flights)\n  .slice(0, 10);\n\n  const displayedDirections = directionData.slice(0, displayCount);\n\n  const directionsLabels = displayedDirections.map(d => `${d.airport1} → ${d.airport2}`);\n  const directionsCounts = displayedDirections.map(d => d.total_flights);\n  \n  const directionsChartData = {\n    labels: directionsLabels,\n    datasets: [{\n      label: 'Количество рейсов',\n      data: directionsCounts,\n      backgroundColor: directionsLabels.map(() =>\n        `hsl(${Math.floor(Math.random() * 360)}, 70%, 70%)`\n      ),\n    }],\n  };\n\n  const directionsChartOptions = {\n    responsive: true,\n    plugins: {\n      tooltip: {\n        callbacks: {\n          label: context => {\n            const idx = context.dataIndex;\n            const item = displayedDirections[idx];\n            return [\n              `Рейсов: ${item.total_flights}`,\n              `Пунктуальность: ${item.on_time_percentage ?? 'н/д'}%`\n            ];\n          }\n        }\n      },\n      legend: { display: false }\n    }\n  };\n  \n// Пунктуальность - если даты нет, просто покажем среднюю пунктуальность по авиакомпаниям\nconst airlines = [...new Set(punctualityData.map(d => d['Авиакомпания']))];\n\nconst punctualityChartData = {\n  labels: airlines,\n  datasets: [\n    {\n      label: 'Пунктуальность отправления (%)',\n      data: airlines.map(airline => {\n        const rec = punctualityData.find(d => d['Авиакомпания'] === airline);\n        return rec ? rec['Отправление'] : 0;\n      }),\n      backgroundColor: 'rgba(75,192,192,0.6)',\n    },\n    {\n      label: 'Пунктуальность прибытия (%)',\n      data: airlines.map(airline => {\n        const rec = punctualityData.find(d => d['Авиакомпания'] === airline);\n        return rec ? rec['Прибытие'] : 0;\n      }),\n      backgroundColor: 'rgba(153,102,255,0.6)',\n    },\n  ],\n};\n\n\n\nreturn (\n  <div style={{ maxWidth: 1000, height: 900, margin: '20px auto', fontFamily: 'Arial, sans-serif' }}>\n    <h2 style={{ textAlign: 'center', marginBottom: 20 }}>Аналитика авиакомпаний — выберите график</h2>\n    \n    <div style={{ display: 'flex', justifyContent: 'center', gap: 15, marginBottom: 30 }}>\n      <button\n        onClick={() => setActiveTab('top3')}\n        disabled={activeTab === 'top3'}\n        style={{\n          padding: '10px 20px',\n          borderRadius: 8,\n          border: 'none',\n          cursor: activeTab === 'top3' ? 'default' : 'pointer',\n          backgroundColor: activeTab === 'top3' ? '#4caf50' : '#e0e0e0',\n          color: activeTab === 'top3' ? 'white' : '#333',\n          fontWeight: 'bold',\n          transition: 'background-color 0.3s',\n        }}\n        onMouseEnter={e => {\n          if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#81c784';\n        }}\n        onMouseLeave={e => {\n          if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#e0e0e0';\n        }}\n      >\n        Топ 3 авиакомпании\n      </button>\n\n      <button\n        onClick={() => setActiveTab('directions')}\n        disabled={activeTab === 'directions'}\n        style={{\n          padding: '10px 20px',\n          borderRadius: 8,\n          border: 'none',\n          cursor: activeTab === 'directions' ? 'default' : 'pointer',\n          backgroundColor: activeTab === 'directions' ? '#4caf50' : '#e0e0e0',\n          color: activeTab === 'directions' ? 'white' : '#333',\n          fontWeight: 'bold',\n          transition: 'background-color 0.3s',\n        }}\n        onMouseEnter={e => {\n          if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#81c784';\n        }}\n        onMouseLeave={e => {\n          if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#e0e0e0';\n        }}\n      >\n        Направления\n      </button>\n\n      <button\n        onClick={() => setActiveTab('punctuality')}\n        disabled={activeTab === 'punctuality'}\n        style={{\n          padding: '10px 20px',\n          borderRadius: 8,\n          border: 'none',\n          cursor: activeTab === 'punctuality' ? 'default' : 'pointer',\n          backgroundColor: activeTab === 'punctuality' ? '#4caf50' : '#e0e0e0',\n          color: activeTab === 'punctuality' ? 'white' : '#333',\n          fontWeight: 'bold',\n          transition: 'background-color 0.3s',\n        }}\n        onMouseEnter={e => {\n          if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#81c784';\n        }}\n        onMouseLeave={e => {\n          if (!e.currentTarget.disabled) e.currentTarget.style.backgroundColor = '#e0e0e0';\n        }}\n      >\n        Авиакомпании\n      </button>\n    </div>\n\n    {activeTab === 'top3' && (\n      <>\n        <h3 style={{ textAlign: 'center', marginBottom: 10 }}>Топ 3 авиакомпании по пунктуальности</h3>\n        <Bar\n          data={top3ChartData}\n          options={{\n            responsive: true,\n            plugins: { title: { display: false } },\n          }}\n        />\n      </>\n    )}\n\n{activeTab === 'directions' && ( <DirectionsCharts directionData={directionData} />\n  // <>\n  //   <h3 style={{ textAlign: 'center', marginBottom: 5 }}>\n  //     Топ {displayCount} направлений по количеству рейсов\n  //   </h3>\n  //   <p style={{ textAlign: 'center', marginBottom: 15, fontSize: 14, color: '#666' }}>\n  //     Отображаются направления с наибольшим числом рейсов. Наведи на сегмент, чтобы увидеть пунктуальность.\n  //   </p>\n\n  //   <div style={{ textAlign: 'center', marginBottom: 15 }}>\n  //     <input\n  //       type=\"range\"\n  //       min={1}\n  //       max={Math.min(100, directionData.length)}\n  //       value={displayCount}\n  //       onChange={e => setDisplayCount(Number(e.target.value))}\n  //       style={{ width: 300 }}\n  //     />\n  //     <div>{displayCount} направлений</div>\n  //   </div>\n\n  //   <div style={{ height: 500 }}>\n  //     <Pie\n  //       data={directionsChartData}\n  //       options={{\n  //         responsive: true,\n  //         maintainAspectRatio: false,\n  //         plugins: {\n  //           tooltip: {\n  //             callbacks: {\n  //               label: (context) => {\n  //                 const label = context.label || '';\n  //                 const percentage = directionData[context.dataIndex]?.on_time_percentage ?? 'н/д';\n  //                 return `${label}: ${context.formattedValue} рейсов — пунктуальность ${percentage}%`;\n  //               }\n  //             }\n  //           }\n  //         }\n  //       }}\n  //     />\n  //   </div>\n  // </>\n)}\n    {activeTab === 'punctuality' && (\n      <PunctualityChartWithTable data={punctualityData}/>\n      // <>\n      //   <h3 style={{ textAlign: 'center', marginBottom: 10 }}>Пунктуальность авиакомпаний</h3>\n      //   <Bar\n      //     data={punctualityChartData}\n      //     options={{\n      //       responsive: true,\n      //       plugins: { title: { display: false } },\n      //       scales: {\n      //         y: { min: 0, max: 100, title: { display: true, text: 'Пунктуальность (%)' } },\n      //         x: { title: { display: true, text: 'Авиакомпания' } },\n      //       },\n      //     }}\n      //   />\n      // </>\n    )}\n  </div>\n);\n\n};\n\nexport default Analytics;\n"]},"metadata":{},"sourceType":"module"}